@using System.IO
@using System.Net.Mime
@using System.Web.Helpers
@using GDO.Core
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Bootstrap Core CSS -->
    <link href="../../Bootstrap/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="../../Bootstrap/bower_components/metisMenu/dist/metisMenu.css" rel="stylesheet">
    <!-- Timeline CSS -->
    <link href="../../Bootstrap/dist/css/timeline.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../../Bootstrap/dist/css/sb-admin-2.css" rel="stylesheet">
    <!-- Morris Charts CSS -->
    <link href="../../Bootstrap/bower_components/morrisjs/morris.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="../../Bootstrap/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <style>
        body { color: #FFF; }

        .unselectable {
            -moz-user-select: -moz-none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -o-user-select: none;
            user-select: none;
        }

        .btn-file {
            position: relative;
            overflow: hidden;
            background-color: #2a9fd6 !important;
        }

        .btn-file input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            cursor: inherit;
            display: block;
        }

        input[readonly] {
            background-color: #2a9fd6 !important;
            cursor: text !important;
        }

        .file_upload input.upload {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            padding: 0;
            cursor: pointer;
            opacity: 0;
            filter: alpha(opacity=0);
        }

        .input_field_div {
            margin: 0px;
            padding: 0px;
        }

        .input_field {
            width: 100%;
            height: 40px;
            border: 1px solid #333;
            background: #333;
            color: #2a9fd6;
            padding: 0px;
            display: inline-block;
            position: relative;
            text-align: center;
        }
    </style>
</head>
<body unselectable="on" class="unselectable">
<script src="../../Scripts/jquery-2.1.4.min.js"></script>
<script src="../../Scripts/jquery.signalR-2.2.0.min.js"></script>
<script src="../../Scripts/jquery.csv-0.71.min.js"></script>
<script src="../../Bootstrap/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="../../Bootstrap/dist/js/sb-admin-2.js"></script>
<script src="../../Bootstrap/bower_components/metisMenu/dist/metisMenu.min.js"></script>
<script>
    $(function() {
        var gdo = parent.gdo;
        gdo.net.app["Spreadsheets"].initControl();
        $(document).on('change', '.btn-file :file', function() {
            var input = $(this),
                numFiles = input.get(0).files ? input.get(0).files.length : 1,
                label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
            input.trigger('fileselect', [numFiles, label]);
        });
        $(document).ready(function() {
            $('.btn-file :file').on('fileselect', function(event, numFiles, label) {
                var id = '#filename-' + event.target.id;
                if (label === "" || label === undefined) {
                    $(id).text('No file Selected');
                } else {
                    $(id).text(label);
                }

            });
        });
    });
</script>
<div class="wrapper" style="width: 97%">
    <div class="row">
        <div class="col-lg-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h6><i class='fa  fa-comment-o  fa-fw'></i>&nbsp;Upload</h6>
                </div>
                <div class="panel-body">
                    @{
                        var sheetPath = "";
                        var sheet = "";
                        var variable = "";
                        var variablePath = "";
                        if (IsPost)
                        {
                            HttpPostedFileBase sheetFile = Request.Files[0];
                            HttpPostedFileBase inputFile = Request.Files[1];
                            if (sheetFile != null && inputFile != null)
                            {
                                //Spreadsheet Excel Specification
                                sheet = Path.GetFileName(sheetFile.FileName);
                                Directory.CreateDirectory(System.Web.HttpContext.Current.Server.MapPath("~/Web/Spreadsheets/Sheet/"));
                                sheetPath = System.Web.HttpContext.Current.Server.MapPath("~/Web/Spreadsheets/Sheet/") + sheet;
                                sheetFile.SaveAs(sheetPath);
                                //Variable Excel Specification
                                variable = Path.GetFileName(inputFile.FileName);
                                Directory.CreateDirectory(System.Web.HttpContext.Current.Server.MapPath("~/Web/Spreadsheets/Var/"));
                                variablePath = System.Web.HttpContext.Current.Server.MapPath("~/Web/Spreadsheets/Var/") + variable;
                                inputFile.SaveAs(variablePath);
                            }
                        }
                    }
                    <form id="file_upload_form" action="" method="post" data-ajax="false" enctype="multipart/form-data">
                    <table style="border-collapse: separate; border-spacing: 3px; background-color: transparent;">
                        <tr>
                            <td>
                                <div style="background-color: transparent">
                                    <h6>Upload Spreadsheet File:</h6>
                                </div>
                            </td>
                            <td>
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <span class="btn btn-file btn-default"><span>Choose file</span><input id="sheet" name="sheet" type="file" accept=".xls,.xlsx" /></span>
                                    <span class="fileinput-filename"></span><span id="filename-sheet" class="fileinput-new">No file chosen</span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div style="background-color: transparent">
                                    <h6>Upload Variables:</h6>
                                </div>
                            </td>
                            <td>
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <span class="btn btn-file btn-default"><span>Choose file</span><input id="var" name="input" type="file" accept=".xls,.xlsx" /></span>
                                    <span class="fileinput-filename"></span><span id="filename-var" class="fileinput-new">No file chosen</span>
                                </div>
                            </td>
                        </tr>
                    </table>
                    </form>
                </div>
                <div class="panel-footer">
                    <fieldset>
                        <button id="spreadsheet_submit" class="btn btn-success btn-circle btn-xl center-block format_button ">
                            <i class='fa  fa-check fa-fw'></i>
                        </button>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
</div>
@if (sheetPath != "" && variablePath != "")
{
    <script>
        $(function() {
            $(document).ready(function() {
                var gdo = parent.gdo;
                gdo.consoleOut('.Spreadsheet', 1, 'Instance ' + gdo.controlId + ": Uploaded files [" + "@sheet" + "," + "@variable" + "]");
            });

        });
    </script>
}
</body>
</html>