@using System.IO
@using System.Web.Helpers
@using GDO.Core
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <style>
        body {
            background: #222;
            color: #FFF;
            font-family: helvetica;
            font-size: 70%;
        }

        .unselectable {
            -moz-user-select: -moz-none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -o-user-select: none;
            user-select: none;
        }

        .thumb {
            height: 75px;
            border: 1px solid #000;
            margin: 10px 5px 0 0;
        }

        .table_control td {
            text-align:center;
            border: 1px solid #FFF;
            padding: 8px;
            font-size:1.4em;
        }

        table.table_control {
            /*border-collapse:collapse;*/
        }

        .green {
            background-color:#006400;
        }
        
        .red {
            background-color:#8B0000;
        }

    </style>
</head>
<body>
    <script src="../../Scripts/jquery-1.11.3.min.js"></script>
    <script src="../../Scripts/jquery.signalR-2.2.0.min.js"></script>
    <script>
        $(function () {
            $(document).ready(function () {
                var gdo = parent.gdo;
                var server = gdo.net.app.DD3.server;
                var instanceId;
                var confId;
                var test_bench = [];

                var callback = function (message) {
                    confId = message.configurationId;
                    if (message.state == 1) {
                        test_bench[confId]();
                        $("#wait").css("display", "none");
                        $("#control_" + confId).css("display", "");
                    }
                };

                var order = function (name, args) {
                    return JSON.stringify({ name: name, args: args });
                };

                if (!gdo.net.app["DD3"].initControl) {
                    $("#wait").css("display", "none");
                    $("#error").css("display", "");
                    return;
                }

                instanceId = gdo.net.app["DD3"].initControl(callback);

                test_bench[0] = function () {
                    var rect = false, circles = false, dcircles = false;

                    // == Basic Moves ==

                    $('#createRect').click(function () {
                        if (!rect) {
                            server.sendOrder(instanceId, order("createRect", []), false);
                            $(".basic_moves .red").removeClass("red").addClass("green");
                            $(this).removeClass("green").addClass("red");
                            rect = true;
                        }
                    });

                    $('#removeRect').click(function () {
                        if (rect) {
                            server.sendOrder(instanceId, order("removeRect", []), false);
                            $(".basic_moves .green").removeClass("green").addClass("red");
                            $('#createRect').removeClass("red").addClass("green");
                            rect = false;
                        }
                    });

                    $('#translationX').click(function () {
                        rect && server.sendOrder(instanceId, order("startXTranslation", ['X']), false);
                    });

                    $('#translationY').click(function () {
                        rect && server.sendOrder(instanceId, order("startYTranslation", ['Y']), false);
                    });

                    $('#rotation').click(function () {
                        rect && server.sendOrder(instanceId, order("startRotation", ['R']), false);
                    });

                    $('#allMoves').click(function () {
                        if (rect) {
                            server.sendOrder(instanceId, order("startXTranslation", ["X"]), false);
                            server.sendOrder(instanceId, order("startYTranslation", ["Y"]), false);
                            server.sendOrder(instanceId, order("startRotation", ["R"]), false);
                        }
                    });

                    // == Superposition ==

                    $('#createCircles').click(function () {
                        if (!circles) {
                            server.sendOrder(instanceId, order("createCircles", [100, 1]), false);
                            $(".superposition.non_distributed .red").removeClass("red").addClass("green");
                            $(this).removeClass("green").addClass("red");
                            circles = true;
                        }
                    });

                    $('#createDistributedCircles').click(function () {
                        if (!dcircles) {
                            server.sendOrder(instanceId, order("createDistributedCircles", [10, 0.9]), true);
                            $(".superposition.distributed .red").removeClass("red").addClass("green");
                            $(this).removeClass("green").addClass("red");
                            dcircles = true;
                        }
                    });

                    $('#removeCircles').click(function () {
                        if (circles) {
                            server.sendOrder(instanceId, order("removeCircles", []), false);
                            $(".superposition.non_distributed .green").removeClass("green").addClass("red");
                            $('#createCircles').removeClass("red").addClass("green");
                            circles = false;
                        }
                    });

                    $('#removeDistributedCircles').click(function () {
                        if (dcircles) {
                            server.sendOrder(instanceId, order("removeDistributedCircles", []), true);
                            $(".superposition.distributed .green").removeClass("green").addClass("red");
                            $('#createDistributedCircles').removeClass("red").addClass("green");
                            dcircles = false;
                        }
                    });

                    $('#moveCircles').click(function () {
                        circles && server.sendOrder(instanceId, order("startMoveCircles", []), false);
                    });

                    $('#moveDistributedCircles').click(function () {
                        dcircles && server.sendOrder(instanceId, order("startMoveDistributedCircles", []), true);
                    });

                };

            });
        });
    </script>

    <div id="wait" style="">
        Please wait while app is initializing...
    </div>

    <div id="error" style="display:none">
        <p style="color: rgb(237, 20, 51);font-size: 2.5em;">
            :(
        </p>
        <p style="color: rgb(237, 20, 51);font-size:2.5em;">
            Something went wrong, please reload the page<br>
            <span style="color:firebrick;font-size:0.7em;font-style:italic"> Error : the function 'initControl' was not initialized</span>
        </p>
    </div>

    <div id="control_0" style="display:none">
        <table class="table_control">
            <tr class="basic_moves">
                <td colspan="3">Basic moves</td>
            </tr>
            <tr class="basic_moves">
                <td rowspan="4" class="green" id="createRect">Create Rectangle</td>
                <td class="red" id="translationX">X Translation</td>
                <td rowspan="4" class="red" id="removeRect">Remove Rectangle</td>
            </tr>
            <tr class="basic_moves">
                <td class="red" id="translationY">Y Translation</td>
            </tr>
            <tr class="basic_moves">
                <td class="red" id="rotation">Rotation</td>
            </tr>
            <tr class="basic_moves">
                <td class="red" id="allMoves">All</td>
            </tr>
            <tr>
                <td colspan="3">Superposition</td>
            </tr>
            <tr class="superposition non_distributed">
                <td class="green" id="createCircles">Create Circles</td>
                <td class="red" id="moveCircles">Move Circles</td>
                <td class="red" id="removeCircles">Remove Circles</td>
            </tr>
            <tr class="superposition distributed">
                <td class="green" id="createDistributedCircles">Create distributed Circles</td>
                <td class="red" id="moveDistributedCircles">Move distributed Circles</td>
                <td class="red" id="removeDistributedCircles">Remove distributed Circles</td>
            </tr>
            <tr>
                <td colspan="3">Group transition (Not implemented)</td>
            </tr>
            <tr>
                <td rowspan="2" class="green">Create</td>
                <td class="red">Test 1</td>
                <td rowspan="2" class="red">Remove</td>
            </tr>
            <tr>
                <td class="red">Test 2</td>
            </tr>
        </table>
    </div>

    <div id="control_1" style="display:none">
        Here will be the control panel for test 1
    </div>

</body>
</html>
